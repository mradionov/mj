/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/loop.ts":
/*!*********************!*\
  !*** ./src/loop.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RenderLoop = void 0;\nvar DEFAULT_OPTIONS = {\n    deltaTimeLimit: 1,\n    // requestAnimationFrame is usually 60 fps; in seconds\n    fps: 60,\n};\nvar State;\n(function (State) {\n    State[State[\"Idle\"] = 0] = \"Idle\";\n    State[State[\"Working\"] = 1] = \"Working\";\n    State[State[\"StopRequested\"] = 2] = \"StopRequested\";\n})(State || (State = {}));\nvar RenderLoop = /** @class */ (function () {\n    function RenderLoop(options) {\n        if (options === void 0) { options = {}; }\n        var _this = this;\n        this.lastTimestamp = null;\n        this.state = State.Idle;\n        this.loop = function (timestamp) {\n            var _a, _b;\n            if (timestamp === void 0) { timestamp = null; }\n            if (_this.state === State.Idle) {\n                return;\n            }\n            if (_this.state === State.StopRequested) {\n                _this.state = State.Idle;\n                return;\n            }\n            var idealDeltaTime = _this.getIdealDeltaTime();\n            // For the very first run loop() is called from the code and timestamp is\n            // not known. On the second call loop() is called by requestAnimationFrame,\n            // which also provides a timestamp.\n            // Use ideal fixed delta value for the first run.\n            var deltaTime = idealDeltaTime;\n            if (timestamp !== null) {\n                // Timestamp is originally in milliseconds, convert to seconds\n                var deltaTimestamp = timestamp - _this.lastTimestamp;\n                if (Math.round(_this.getFpsInterval()) - Math.round(deltaTimestamp) > 2) {\n                    window.requestAnimationFrame(_this.loop);\n                    return;\n                }\n                deltaTime = deltaTimestamp / 1000;\n                // If delta is too large, we must have resumed from stop() or breakpoint.\n                // Use ideal default delta only for this frame.\n                if (deltaTime > _this.options.deltaTimeLimit) {\n                    deltaTime = idealDeltaTime;\n                }\n            }\n            _this.lastTimestamp = timestamp;\n            var lastTime = timestamp / 1000;\n            (_b = (_a = _this.options).onTick) === null || _b === void 0 ? void 0 : _b.call(_a, { deltaTime: deltaTime, lastTime: lastTime });\n            window.requestAnimationFrame(_this.loop);\n        };\n        this.options = Object.assign({}, DEFAULT_OPTIONS, options);\n    }\n    RenderLoop.prototype.start = function () {\n        if (this.state !== State.Idle) {\n            return;\n        }\n        this.state = State.Working;\n        this.loop();\n    };\n    // WARNING: a couple of already queued callbacks might still fire after stop\n    RenderLoop.prototype.stop = function () {\n        if (this.state !== State.Working) {\n            return;\n        }\n        this.state = State.StopRequested;\n    };\n    RenderLoop.prototype.getFpsInterval = function () {\n        return 1000 / this.options.fps;\n    };\n    RenderLoop.prototype.getIdealDeltaTime = function () {\n        return 1 / this.options.fps;\n    };\n    return RenderLoop;\n}());\nexports.RenderLoop = RenderLoop;\n\n\n//# sourceURL=webpack:///./src/loop.ts?");

/***/ }),

/***/ "./src/main.ts":
/*!*********************!*\
  !*** ./src/main.ts ***!
  \*********************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

eval("\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nvar loop_1 = __webpack_require__(/*! ./loop */ \"./src/loop.ts\");\nvar tempo_1 = __webpack_require__(/*! ./tempo */ \"./src/tempo.ts\");\nvar renderer_1 = __webpack_require__(/*! ./renderer */ \"./src/renderer.ts\");\nvar node_1 = __webpack_require__(/*! ./node */ \"./src/node.ts\");\nvar WIDTH = 800;\nvar HEIGHT = 600;\nvar canvas = document.createElement('canvas');\ncanvas.width = WIDTH;\ncanvas.height = HEIGHT;\ndocument.body.appendChild(canvas);\nvar gl = canvas.getContext('webgl');\nvar fullscreenButton = document.getElementById('fullscreen-btn');\nfullscreenButton.addEventListener('click', function () { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        switch (_a.label) {\n            case 0: return [4 /*yield*/, canvas.requestFullscreen()];\n            case 1:\n                _a.sent();\n                return [2 /*return*/];\n        }\n    });\n}); });\nvar bpmInput = document.getElementById('bpm-input');\nbpmInput.addEventListener('change', function () { });\nfunction update(_a) {\n    var deltaTime = _a.deltaTime;\n    var bpm = Number(bpmInput.value);\n    tempoTracker.setBpm(bpm);\n    tempoTracker.update({ deltaTime: deltaTime });\n    var beatProgress = tempoTracker.getBeatProgress();\n    renderer.update({ beatProgress: beatProgress });\n}\nfunction draw() {\n    renderer.draw({ nodes: nodes });\n}\nfunction tick(_a) {\n    var deltaTime = _a.deltaTime;\n    update({ deltaTime: deltaTime });\n    draw();\n}\nvar nodes = [\n    new node_1.RectNode(10, 10, 100, 100, [1, 0, 0, 1]),\n    new node_1.RectNode(200, 150, 100, 30, [0, 1, 0, 1]),\n    new node_1.RectNode(250, 350, 70, 230, [0, 0, 1, 1]),\n];\nvar renderLoop = new loop_1.RenderLoop({\n    onTick: tick,\n});\nvar tempoTracker = new tempo_1.TempoTracker();\nvar renderer = new renderer_1.Renderer(gl);\nfunction main() {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, renderer.load()];\n                case 1:\n                    _a.sent();\n                    renderLoop.start();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nvoid main();\n\n\n//# sourceURL=webpack:///./src/main.ts?");

/***/ }),

/***/ "./src/node.ts":
/*!*********************!*\
  !*** ./src/node.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.RectNode = void 0;\nvar RectNode = /** @class */ (function () {\n    function RectNode(x, y, width, height, color) {\n        if (color === void 0) { color = [0, 0, 1, 1]; }\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n        this.color = color;\n    }\n    return RectNode;\n}());\nexports.RectNode = RectNode;\n\n\n//# sourceURL=webpack:///./src/node.ts?");

/***/ }),

/***/ "./src/renderer.ts":
/*!*************************!*\
  !*** ./src/renderer.ts ***!
  \*************************/
/***/ (function(__unused_webpack_module, exports) {

eval("\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.Renderer = void 0;\nvar Renderer = /** @class */ (function () {\n    function Renderer(gl) {\n        this.gl = gl;\n    }\n    Renderer.prototype.load = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var gl, vertexShaderText, vertexShader, error, fragmentShaderText, fragmentShader, error, program, error, position;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        gl = this.gl;\n                        return [4 /*yield*/, fetch('shaders/rect_pulse.vert').then(function (r) {\n                                return r.text();\n                            })];\n                    case 1:\n                        vertexShaderText = _a.sent();\n                        vertexShader = gl.createShader(gl.VERTEX_SHADER);\n                        gl.shaderSource(vertexShader, vertexShaderText);\n                        gl.compileShader(vertexShader);\n                        if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n                            error = gl.getShaderInfoLog(vertexShader);\n                            gl.deleteShader(vertexShader);\n                            throw new Error(\"Shader error: \".concat(error));\n                        }\n                        return [4 /*yield*/, fetch('shaders/rect_pulse.frag').then(function (r) { return r.text(); })];\n                    case 2:\n                        fragmentShaderText = _a.sent();\n                        fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n                        gl.shaderSource(fragmentShader, fragmentShaderText);\n                        gl.compileShader(fragmentShader);\n                        if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n                            error = gl.getShaderInfoLog(fragmentShader);\n                            gl.deleteShader(fragmentShader);\n                            throw new Error(\"Shader error: \".concat(error));\n                        }\n                        program = gl.createProgram();\n                        gl.attachShader(program, vertexShader);\n                        gl.attachShader(program, fragmentShader);\n                        gl.linkProgram(program);\n                        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n                            error = gl.getProgramInfoLog(program);\n                            gl.deleteProgram(program);\n                            throw new Error(\"Program error: \".concat(error));\n                        }\n                        gl.useProgram(program);\n                        this.vertexBuffer = gl.createBuffer();\n                        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\n                        position = gl.getAttribLocation(program, 'aPosition');\n                        gl.vertexAttribPointer(position, 2, gl.FLOAT, false, 0, 0);\n                        gl.enableVertexAttribArray(position);\n                        this.progressLocation = gl.getUniformLocation(program, 'uProgress');\n                        this.resolutionLocation = gl.getUniformLocation(program, 'uResolution');\n                        gl.uniform2f(this.resolutionLocation, gl.canvas.width, gl.canvas.height);\n                        this.dimensionsLocation = gl.getUniformLocation(program, 'uDimensions');\n                        this.positionLocation = gl.getUniformLocation(program, 'uPosition');\n                        this.colorLocation = gl.getUniformLocation(program, 'uColor');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Renderer.prototype.update = function (_a) {\n        var beatProgress = _a.beatProgress;\n        var gl = this.gl;\n        gl.uniform1f(this.progressLocation, beatProgress);\n    };\n    Renderer.prototype.draw = function (_a) {\n        var nodes = _a.nodes;\n        var gl = this.gl;\n        gl.clearColor(0, 0, 0, 1);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n        for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {\n            var node = nodes_1[_i];\n            var x1 = node.x;\n            var x2 = node.x + node.width;\n            var y1 = node.y;\n            var y2 = node.y + node.height;\n            var vertices = new Float32Array([\n                x1,\n                y1,\n                x2,\n                y1,\n                x1,\n                y2,\n                x1,\n                y2,\n                x2,\n                y1,\n                x2,\n                y2,\n            ]);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n            gl.uniform2f(this.positionLocation, x1, y1);\n            gl.uniform2f(this.dimensionsLocation, node.width, node.height);\n            gl.uniform4f.apply(gl, __spreadArray([this.colorLocation], node.color, false));\n            gl.drawArrays(gl.TRIANGLES, 0, 6);\n        }\n    };\n    return Renderer;\n}());\nexports.Renderer = Renderer;\n\n\n//# sourceURL=webpack:///./src/renderer.ts?");

/***/ }),

/***/ "./src/tempo.ts":
/*!**********************!*\
  !*** ./src/tempo.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.TempoTracker = void 0;\nvar TempoTracker = /** @class */ (function () {\n    function TempoTracker() {\n        this.bpm = 0;\n        this.beatInterval = 0;\n        this.lastBeatOverflow = 0;\n    }\n    TempoTracker.prototype.setBpm = function (bpm) {\n        this.bpm = bpm;\n        this.beatInterval = 60 / bpm;\n    };\n    TempoTracker.prototype.update = function (_a) {\n        var deltaTime = _a.deltaTime;\n        if (this.beatInterval === 0) {\n            throw new Error('Beat interval cannot be 0');\n        }\n        var accumulated = this.lastBeatOverflow + deltaTime;\n        if (accumulated < this.beatInterval) {\n            this.lastBeatOverflow += deltaTime;\n            return;\n        }\n        this.lastBeatOverflow = accumulated % this.beatInterval;\n    };\n    TempoTracker.prototype.getBeatProgress = function () {\n        return this.lastBeatOverflow / this.beatInterval;\n    };\n    return TempoTracker;\n}());\nexports.TempoTracker = TempoTracker;\n\n\n//# sourceURL=webpack:///./src/tempo.ts?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __webpack_exports__ = __webpack_require__("./src/main.ts");
/******/ 	
/******/ })()
;